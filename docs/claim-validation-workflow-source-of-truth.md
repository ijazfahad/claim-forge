# Claim Validation Workflow - Source of Truth

## Overview
This document defines the authoritative workflow for the claim validation system. This is the single source of truth for how the validation process works.

## Workflow Steps

### 1. Sanity Agent
- **Purpose**: Initial clinical validation of CPT/ICD codes
- **Process**: 
  - Calls OpenAI GPT-4o to validate CPT/ICD codes based on doctor's notes
  - Checks if codes are clinically appropriate for the documented care
- **Decision**: If codes look good → proceed to step 2

### 2. CMS/NCCI Rules Check
- **Purpose**: Validate against official Medicare coding rules
- **Process**:
  - Validates CPT rules against CMS/NCCI database
  - Checks bundling edits, modifier requirements, frequency limits
  - Validates place of service and revenue code requirements
- **Decision**: If all rules pass → proceed to step 3

### 3. Planner Agent
- **Purpose**: Generate research questions and search queries
- **Process**:
  - Creates basic questions related to the claim
  - Creates specialty-specific questions based on the claim type
  - Generates Google search queries for policy research
- **Output**: List of questions and search queries

### 4. Google Search
- **Purpose**: Find relevant URLs for policy research
- **Process**:
  - Executes the search queries generated by Planner Agent
  - Returns relevant URLs from authoritative sources (CMS, AMA, etc.)

### 5. Firecrawl
- **Purpose**: Extract content from URLs and answer questions
- **Process**:
  - Extracts content from URLs found by Google Search
  - Uses the Planner Agent's questions to find specific answers
  - Attempts to answer all research questions from extracted content

### 6. Research Agent (Fallback)
- **Purpose**: Answer questions that Firecrawl couldn't resolve
- **Process**:
  - For questions that Firecrawl couldn't answer
  - Makes web_search calls using OpenAI APIs
  - Attempts to find answers through AI-powered web research

### 7. Retry Research Agent (Final Fallback)
- **Purpose**: Answer remaining unanswered questions
- **Process**:
  - Uses OpenAI GPT-5 model to answer questions
  - Applies domain knowledge and reasoning
  - Final attempt to resolve any remaining questions

### 8. Evaluation Agent
- **Purpose**: Make final claim decision
- **Process**:
  - Evaluates the claim using all collected data from previous steps
  - Considers AI clinical validation, CMS/NCCI rules, and research findings
  - Makes final GO/NO_GO decision with confidence scoring
- **Output**: Final validation result with detailed reasoning

## Complete Flow

```
Claim Input
    ↓
1. Sanity Agent (OpenAI GPT-4o clinical validation)
    ↓ (if codes look good)
2. CMS/NCCI Rules Check
    ↓ (if all rules pass)
3. Planner Agent (generate questions + search queries)
    ↓
4. Google Search (find URLs)
    ↓
5. Firecrawl (extract content + answer questions)
    ↓ (for unanswered questions)
6. Research Agent (OpenAI web_search APIs)
    ↓ (for still unanswered questions)
7. Retry Research Agent (OpenAI GPT-5)
    ↓
8. Evaluation Agent (final decision)
    ↓
Final Result (GO/NO_GO)
```

## Key Points

- **Sequential Flow**: Each step builds on the previous one
- **Fallback Strategy**: Multiple research methods ensure comprehensive coverage
- **AI Integration**: Uses multiple OpenAI models for different purposes
- **External Data**: Combines AI reasoning with real-time web research
- **Comprehensive Validation**: Covers clinical, regulatory, and policy aspects

## Agent Responsibilities

| Agent | Primary Function | Fallback Role |
|-------|------------------|---------------|
| Sanity Agent | Clinical code validation | N/A |
| CMS/NCCI Check | Regulatory rule validation | N/A |
| Planner Agent | Question generation | N/A |
| Google Search | URL discovery | N/A |
| Firecrawl | Content extraction & Q&A | N/A |
| Research Agent | Web research for unanswered Qs | Primary research method |
| Retry Research Agent | AI reasoning for remaining Qs | Final research attempt |
| Evaluation Agent | Final decision making | N/A |

## Last Updated
December 2024

## Status
Source of Truth - Do not modify without approval
